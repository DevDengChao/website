<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="serverless-devs-ci-cd-github-action-usage" />
	<meta name="description" content="serverless-devs-ci-cd-github-action-usage" />
	<!-- 网页标签标题 -->
	<title>如何通过Github Action使用Serverless Devs做CI/CD</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/blogDetail.css" />
</head>
<body>
	<div id="root"><div class="blog-detail-page" data-reactroot=""><header class="header-container header-container-normal"><a href="/zh-cn/index.html" class="logo-link"><img class="logo" src="/img/sdLogoblack.png"/></a><div class="header-body"><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><div class="nav-container"><a href="/zh-cn/products/index.html"><div class="word">产品</div></a><ul class="sub-nav-container" style="width:220px"><li><a href="/zh-cn/desktop/index.html" target="_blank" style="display:block;width:100%;height:100%">Serverless Desktop</a></li><li><a href="/zh-cn/cli/index.html" target="_blank" style="display:block;width:100%;height:100%">Serverless Cli</a></li><li><a href="https://serverlesshub.resume.net.cn?spm=serverlessdevs.topbar.0.0.0" target="_blank" style="display:block;width:100%;height:100%">Serverless Hub</a></li></ul> </div></li><li class="menu-item menu-item-normal"><div class="nav-container"><a href="/zh-cn/developer/index.html"><div class="word">开发者</div></a><ul class="sub-nav-container" style="width:220px"><li><a href="/zh-cn/docs/overview/intro.html" target="_blank" style="display:block;width:100%;height:100%">文档</a></li><li><a href="/zh-cn/docs/quickstart/desktop-quickstart.html" target="_blank" style="display:block;width:100%;height:100%">快速开始</a></li><li><a href="https://github.com/Serverless-Devs/Serverless-Devs/discussions" target="_blank" style="display:block;width:100%;height:100%">社区活动</a></li><li><a href="https://github.com/Serverless-Devs/Serverless-Devs" target="_blank" style="display:block;width:100%;height:100%">开源</a></li></ul> </div></li><li class="menu-item menu-item-normal"><span><a href="https://serverlesshub.resume.net.cn?spm=serverlessdevs.topbar.0.0.0" target="_blank">应用中心</a></span></li><li class="menu-item menu-item-normal"><div class="nav-container"><a href=""><div class="word">企业级Serverless解决方案</div></a><ul class="sub-nav-container" style="width:220px"><li><a href="https://www.aliyun.com/product/fc?spm=serverlessdevs..topbar.0.0.0" target="_blank" style="display:block;width:100%;height:100%">函数计算 FC</a></li><li><a href="https://www.aliyun.com/product/aliware/sae?spm=serverlessdevs..topbar.0.0.0" target="_blank" style="display:block;width:100%;height:100%">Serverless 应用引擎</a></li></ul> </div></li><li class="menu-item menu-item-normal menu-item-normal-active"><span><a href="/zh-cn/blog/index.html">博客</a></span></li><li class="menu-item menu-item-normal"><span><a href="https://github.com/Serverless-Devs/Serverless-Devs/discussions" target="_blank">社区</a></span></li></ul></div><div class="header-more-action"><div style="float:right" class="get-start"><a class="button button-primary" target="_self" href="/zh-cn/developer/index.html">开始使用</a></div><div class="search search-normal"><span class="icon-search"></span></div></div></div></header><section class="blog-content markdown-body"><h1 id="%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87github-action%E4%BD%BF%E7%94%A8serverless-devs%E5%81%9Aci%2Fcd">如何通过Github Action使用Serverless Devs做CI/CD <a class="header-anchor" href="#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87github-action%E4%BD%BF%E7%94%A8serverless-devs%E5%81%9Aci%2Fcd">#</a></h1>
<p>当我们在体验Serverless之后，欲将项目真真实实的部署到Serverless架构时，CI/CD是我们很多人绕不开的话题，那么基于Serverless Devs这款工具，如何快速的和Github Action进行有机结合，实现CI/CD的能力呢？</p>
<h2 id="ci%2Fcd%E7%9A%84%E2%80%9C%E8%84%9A%E6%89%8B%E6%9E%B6%E2%80%9D">CI/CD的“脚手架” <a class="header-anchor" href="#ci%2Fcd%E7%9A%84%E2%80%9C%E8%84%9A%E6%89%8B%E6%9E%B6%E2%80%9D">#</a></h2>
<p>现在有很多的脚手架，但是Serverless CI/CD的脚手架应该还是少数的，而Serverless Devs为我们提供了一个CI/CD的脚手架，以Github Action为例，我们可以执行代码，快速在项目下初始化CI/CD模板。</p>
<p>例如，当前我的项目结构：</p>
<p><img src="https://user-images.githubusercontent.com/21079031/120759969-27bccf80-c546-11eb-9260-64724df2e5f5.png" alt="image"></p>
<p>此时，我只需要告诉Serverless Devs，我要生成一个Github Action模板即可：</p>
<pre><code>s cli cicd github
</code></pre>
<p><img src="https://user-images.githubusercontent.com/21079031/120760086-48852500-c546-11eb-9c38-66dbfd82e632.png" alt="image"></p>
<p>我们可以看到，系统会在当前项目创建相对应的CI/CD模板：</p>
<p><img src="https://user-images.githubusercontent.com/21079031/120760172-681c4d80-c546-11eb-9551-ba3e060e2947.png" alt="image"></p>
<p>至此，我们完成了第一个步骤，初始化一个CI/CD的模板。</p>
<h2 id="%E6%B5%81%E7%A8%8B%E9%85%8D%E7%BD%AE">流程配置 <a class="header-anchor" href="#%E6%B5%81%E7%A8%8B%E9%85%8D%E7%BD%AE">#</a></h2>
<h3 id="yml%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE">Yml文件配置 <a class="header-anchor" href="#yml%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE">#</a></h3>
<p>系统所为我们生成的模板文件实际上是一个非常简单的案例：</p>
<pre><code class="language-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Serverless</span> <span class="hljs-string">Devs</span> <span class="hljs-string">Project</span> <span class="hljs-string">CI/CD</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> <span class="hljs-string">[</span> <span class="hljs-string">master</span> <span class="hljs-string">]</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">serverless-devs-cd:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">12</span>
          <span class="hljs-attr">registry-url:</span> <span class="hljs-string">https://registry.npmjs.org/</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">@serverless-devs/s</span>
      <span class="hljs-comment"># 默认密钥配置指令是阿里云密钥配置指令，更多可以参考：</span>
      <span class="hljs-comment"># 如何通过Github Action使用Serverless Devs做CI/CD：http://short.devsapp.cn/cicd/github/action/usage</span>
      <span class="hljs-comment"># Serverless Devs的官网是通过Serverless Devs部署的: http://short.devsapp.cn/cicd/github/action/practice</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">s</span> <span class="hljs-string">config</span> <span class="hljs-string">add</span> <span class="hljs-string">--AccountID</span> <span class="hljs-string">${{secrets.AccountID}}</span> <span class="hljs-string">--AccessKeyID</span> <span class="hljs-string">${{secrets.AccessKeyID}}</span> <span class="hljs-string">--AccessKeySecret</span> <span class="hljs-string">${{secrets.AccessKeySecret}}</span> <span class="hljs-string">-a</span> <span class="hljs-string">default</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">s</span> <span class="hljs-string">deploy</span>
</code></pre>
<p>整个核心流程是：</p>
<ol>
<li>下载<code>serverless-devs</code></li>
<li>配置密钥信息</li>
<li>项目部署（执行<code>s deploy</code>命令）</li>
</ol>
<p>但是在实际生产过程中，我们可能需要自定义使用一些功能，此时可以参考Github Action的文档：<a href="https://docs.github.com/cn/actions">https://docs.github.com/cn/actions</a></p>
<p>例如，我在下载<code>serverless-devs</code>之后，配置密钥之后，我需要进行<code>build</code>等操作，操作之后，我在删除临时生成的文件夹&quot;./abc&quot;，此时我们可以：</p>
<pre><code class="language-yaml"><span class="hljs-string">...</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">@serverless-devs/s</span>
      <span class="hljs-comment"># 默认密钥配置指令是阿里云密钥配置指令，更多可以参考：</span>
      <span class="hljs-comment"># 如何通过Github Action使用Serverless Devs做CI/CD：http://short.devsapp.cn/cicd/github/action/usage</span>
      <span class="hljs-comment"># Serverless Devs的官网是通过Serverless Devs部署的: http://short.devsapp.cn/cicd/github/action/practice</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">s</span> <span class="hljs-string">config</span> <span class="hljs-string">add</span> <span class="hljs-string">--AccountID</span> <span class="hljs-string">${{secrets.AccountID}}</span> <span class="hljs-string">--AccessKeyID</span> <span class="hljs-string">${{secrets.AccessKeyID}}</span> <span class="hljs-string">--AccessKeySecret</span> <span class="hljs-string">${{secrets.AccessKeySecret}}</span> <span class="hljs-string">-a</span> <span class="hljs-string">default</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">s</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">rm</span> <span class="hljs-string">-rf</span> <span class="hljs-string">./abc</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">s</span> <span class="hljs-string">deploy</span>
</code></pre>
<p>所以，具体的流程，我们完全可以根据需求自定义。</p>
<h3 id="%E8%B4%A6%E5%8F%B7%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE">账号信息配置 <a class="header-anchor" href="#%E8%B4%A6%E5%8F%B7%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE">#</a></h3>
<p>在上一个流程中，我们涉及到密钥信息的配置，我们可以使用Serverless Devs为我们提供的<code>s config add</code>命令进行。</p>
<p>例如，阿里云的账号体系需要<code>AccountID</code>,<code>AccessKeyID</code>,<code>AccessKeySecret</code>等内容，此时我们可以：</p>
<ol>
<li>将密钥信息配置到Github Secrets中</li>
</ol>
<p><img src="https://user-images.githubusercontent.com/21079031/120761131-71f28080-c547-11eb-9bb8-e08dafabb4ee.png" alt="image"></p>
<p>我们创建多对密钥信息：</p>
<p><img src="https://user-images.githubusercontent.com/21079031/120761249-93ec0300-c547-11eb-9c0d-904fb85b4201.png" alt="image"></p>
<p>例如，我此处配置了三对密钥：</p>
<ul>
<li><code>ALIYUN_ACCOUNT_ID</code>对应阿里云密钥体系中的<code>AccountID</code>；</li>
<li><code>ALIYUN_ACCESS_KEY_ID</code>对应阿里云密钥体系中的<code>AccessKeyID</code>；</li>
<li><code>ALIYUN_ACCESS_KEY_SECRET</code>对应阿里云密钥体系中的<code>AccessKeySecret</code></li>
</ul>
<p><img src="https://user-images.githubusercontent.com/21079031/120761347-ae25e100-c547-11eb-9bcd-4fc742671bc5.png" alt="image"></p>
<p>我此时则可以对应配置：</p>
<pre><code>s config add --AccountID ${{secrets.ALIYUN_ACCOUNT_ID}} --AccessKeyID ${{secrets.ALIYUN_ACCESS_KEY_ID}} --AccessKeySecret ${{secrets.ALIYUN_ACCESS_KEY_SECRET}} -a website_access
</code></pre>
<p>当然，不同厂商可能需要不同的密钥信息配置，部分情况下厂商可能还需要配置临时密钥，此时可以通过<code>s config add -h</code>获取密钥配置的帮助文档：</p>
<pre><code>jiangyu@ServerlessSecurity ~ % s config add -h
Usage: s config add [commands] [name]

You can add an account

    Example:
        $ s config add
        $ s config add --AccessKeyID ****** --AccessKeySecret ****** --AccountID ******
        $ s config add --AccessKey ****** --SecretKey ******
  
    Configuration parameters for cloud vendors:
        alibaba: AccountID, AccessKeyID, AccessKeySecret
        aws: AccessKeyID, SecretAccessKey
        baidu: AccessKeyID, SecretAccessKey
        huawei: AccessKey, SecretKey
        google: PrivateKeyData
        tencent: AccountID, SecretID, SecretKey

🧭 How to get the key: https://github.com/Serverless-Devs/docs/tree/master/zh/others/provider-config

Options:
  --AccountID [AccountID]              AccountID of key information
  --AccessKeyID [AccessKeyID]          AccessKeyID of key information
  --AccessKeySecret [AccessKeySecret]  AccessKeySecret of key information
  --SecretAccessKey [SecretAccessKey]  SecretAccessKey of key information
  --AccessKey [AccessKey]              AccessKey of key information
  --SecretKey [SecretKey]              SecretKey of key information
  --SecretID [SecretID]                SecretID of key information
  --PrivateKeyData [PrivateKeyData]    PrivateKeyData of key information
  -kl , --keyList [keyList]            Keys of key information, like: -kl key1,key2,key3
  -il , --infoList [infoList]          Values of key information, like: -kl info1,info2,info3
  -a , --aliasName [name]              Key pair alias, if the alias is not set, use default instead
  -h, --help                           Display help for command
</code></pre>
<blockquote>
<p>如何配置自定义Key-Value的密钥，例如某个组件是我自己开发的，我需要配置一个Key为tempToken1，Value为tempValue1，和Key为tempToken2，Value为tempValue2，别名为demo的密钥对？
此时可以通过参数<code>-kl , --keyList [keyList]</code>和<code>-il , --infoList [infoList]</code>自定义添加，例如：<code>s config add -kl tempToken1,tempToken2 -il tempValue1,tempValue2 -a demo</code>
<img src="https://user-images.githubusercontent.com/21079031/120762289-adda1580-c548-11eb-9684-87767b6fe109.png" alt="image"></p>
</blockquote>
<blockquote>
<p>密钥中的别名有什么？
密钥中的别名，是为了帮助Serverless Devs更快的识别出你要用的密钥信息，主要是在Yaml中体现，例如：
<img src="https://user-images.githubusercontent.com/21079031/120762524-eb3ea300-c548-11eb-83ec-73dabc2029c9.png" alt="image">
在此处配置的密钥信息（默认是default），如果此处配置了密钥别名是&quot;default&quot;，那么系统就会在执行相关操作的时候，去获取名为&quot;default&quot;的密钥信息；</p>
</blockquote>
<blockquote>
<p>我的一个应用中，涉及到部署到多个平台，需要多个密钥信息，如何配置？<br>
例如，当存在项目：
<img src="https://user-images.githubusercontent.com/21079031/120762886-45d7ff00-c549-11eb-8d01-743ad858d611.png" alt="image">
此时，该app中涉及到两个Service，分别用了不同的组件以及不同的密钥内容<code>website_access</code>, <code>fc_access</code><br>
我们可以通过配置多个密钥信息来进行CI/CD的配置</p>
<ol>
<li>在Github Secrets处配置对应的Key-Value</li>
<li>在生成的<code>.github/workflow/serverless-devs.yml</code>文件中配置密钥信息：</li>
</ol>
<pre><code>s config add -kl tempToken1,tempToken2 -il tempValue1,tempValue2 -a website_access
s config add -kl tempToken3,tempToken4 -il tempValue3,tempValue4 -a fc_access
</code></pre>
</blockquote>
<h1 id="others">Others <a class="header-anchor" href="#others">#</a></h1>
<p>Best practices：</p>
<ul>
<li>🍉 Serverless Devs的官网是通过Serverless Devs部署的: <a href="http://short.devsapp.cn/cicd/github/action/practice">http://short.devsapp.cn/cicd/github/action/practice</a></li>
</ul>
</section><footer class="footer-container"><div class="footer-body"><div class="cols-container"><div class="col col-12"><h3>愿景</h3><p>Serverless Devs 一款可以在Serverless应用全生命周期发挥作用的开发者工具，致力于打造成为 Serverless 应用开发的基础设施</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/intro.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/quickstart/desktop-quickstart.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/developer/index.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="https://github.com/Serverless-Devs/Serverless-Devs/discussions" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2021 Serverless Devs,Inc. Built with docsite</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/blogDetail.js"></script>
</body>
</html>